---
method: post
---


{% liquid

 assign ingredientArray=context.params.ingredient|split: ','
 assign ingredientIds=[]

 for ingred in ingredientArray

 graphql isIngredExist='item/ingredient/search_bytitle' ,title:ingred

 if isIngredExist.record.id
 
 ingredientIds= ingredientIds|concat:isIngredExist.record.id
 
 else

 graphql createIngredient= 'item/ingredient/create', title:ingred
 ingredientIds= ingredientIds|concat: createIngredient.record.id

 endif

 endfor

graphql result='item/create' ,title:context.params.title ,inggredient:ingredientIds


if result.record.id 
redirect_to '/'
graphql email = 'item/email/created', data: context.params
else
	echo 'Something went wrong'
	echo result.errors
endif

   
%}