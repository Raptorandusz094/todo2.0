---
method: post
---


{% liquid
	
    assign ingredientIds="[]"|parse_json
	assign ingredients= context.params.ingredient | split: ','

	
	
	
	
	for ingred in ingredients
	
	graphql ingredientExist='item/ingredient/search_bytitle' , title:ingred
	
    
	if  ingredientExist.records.total_entries == 0

 
	graphql createIngredient='item/ingredient/create' ,title:ingred 
	  

     assign  ingredientIds=ingredientIds| add_to_array:createIngredient.record.id

	else 
	 assign ingredientIds=ingredientIds|concat: ingredientExist.record.id 


	
  
	 endif
	
   endfor
	
	graphql result = 'item/create', title: context.params.title , ingredientID:  "ingredientIDs"
	
	if result.record.id
	redirect_to '/'
	
	
else
		echo 'Something went wrong'
		echo result.errors
	endif
%}