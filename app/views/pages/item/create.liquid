---
method: post
---


{% liquid
	
    assign ingredientIds="[]" | parse_json
	assign ingredients= context.params.ingredients | split: ','

	assign test="" |split: ","

	
	
	for ingredient in ingredients
	
	graphql ingredientExist='item/ingredient/search_bytitle' , title : ingredient
	
    
	if  ingredientExist.records.total_entries == 0

 
	graphql createIngredient='item/ingredient/create' , title : ingredient

	
	  

     assign  test=test | array_add : createIngredient.records.results.first.id

	else 
	 assign test=test | array_add: ingredientExist.record.results.first.id


	
  
	 endif
	
   endfor
		
	

	
	
     graphql result = 'item/create', title: context.params.title , img : context.params.img_url  , ingredientID: test
	
	if result.record.id
	redirect_to '/'
	
	
else
		echo 'Something went wrong'
		echo result.errors
	endif
%}